

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio Exporter &mdash; eth-portfolio  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing: Adding New Protocols" href="new-protocols.html" />
    <link rel="prev" title="Caching in eth-portfolio" href="caching.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            eth-portfolio
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="source/modules.html">eth_portfolio</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Caching in eth-portfolio</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Portfolio Exporter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-options">Command-Line Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-containers">Docker Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-flow-summary">Data Flow Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-information">Additional Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-extraction-and-portfolio-calculations">Data Extraction and Portfolio Calculations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="new-protocols.html">Contributing: Adding New Protocols</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">eth-portfolio</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Portfolio Exporter</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/exporter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="portfolio-exporter">
<h1>Portfolio Exporter<a class="headerlink" href="#portfolio-exporter" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The Portfolio Exporter is a command-line tool provided by eth-portfolio. It is designed to extract and compile portfolio data – such as token balances, transaction history, and other relevant financial information – into exportable formats that can be further analyzed or integrated with external services.</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Python 3.10 or higher.</p></li>
<li><p>At least 16GB of RAM.</p></li>
<li><p>All dependencies installed as specified in the project’s <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p></li>
<li><p>Proper configuration settings (e.g., API keys, network endpoints) must be set up as required by the portfolio and balance loaders. More info below.</p></li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<p>The Portfolio Exporter should be used via the CLI. Include each of your wallets in the command like so:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eth-portfolio<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--wallet<span class="w"> </span>0x123<span class="w"> </span>--wallet<span class="w"> </span>0x234<span class="w"> </span>--wallet<span class="w"> </span>0x345
</pre></div>
</div>
</div></blockquote>
</section>
<section id="command-line-options">
<h2>Command-Line Options<a class="headerlink" href="#command-line-options" title="Link to this heading"></a></h2>
<p>The Portfolio Exporter supports several command-line options to customize its behavior:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--wallet</span> <span class="pre">&lt;address&gt;</span></code>
Specify a wallet to be included in your portfolio. You can pass this flag multiple times for multiple wallets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--network</span> <span class="pre">&lt;network-id&gt;</span></code>
The brownie network identifier for the rpc you wish to use. default: mainnet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--interval</span> <span class="pre">&lt;interval&gt;</span></code>
The time interval between datapoints. default: 6h</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--first-tx-block</span> <span class="pre">&lt;block&gt;</span></code>
The block of your portfolio’s first transaction, if known. This value, if provided, allows us to speed up processing of your data by limiting the block range we need to query. If not provided, the whole blockchain will be scanned. default: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--export-start-block</span> <span class="pre">&lt;block&gt;</span></code>
The first block in the range you wish to export. default: 0</p></li>
</ul>
</section>
<section id="docker-containers">
<h2>Docker Containers<a class="headerlink" href="#docker-containers" title="Link to this heading"></a></h2>
<p>When you run the Portfolio Exporter, ETH Portfolio will build and start 3 required Docker containers on your system, as well as up to 1 optional container depending on your configuration. These containers work together to collect, store, and visualize your portfolio data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">grafana</span></code>
The Grafana container provides a web-based dashboard for visualizing your portfolio metrics and balances. It is pre-configured with a “Balances” dashboard and uses victoria-metrics as its Prometheus-compatible data source. Grafana is accessible locally (default port 3000) and supports dashboard image rendering via the renderer container. Anonymous access is enabled for convenience.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">renderer</span></code> (optional)
The renderer container runs the official grafana-image-renderer service, enabling Grafana to export dashboards as images. This is useful for generating reports or sharing visualizations. It is tightly integrated with the Grafana container and operates on port 8091 by default. <strong>This container is only started if you pass the ``–start-renderer`` flag to the infra command.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">victoria-metrics</span></code>
victoria-metrics is a high-performance, long-retention time-series database that stores all portfolio and balance metrics. Data is persisted to a local volume for durability, with a default retention period of 10 years. It receives metrics from vmagent and serves as the main data source for Grafana (default port 8428).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vmagent</span></code>
vmagent is responsible for collecting and forwarding metrics to victoria-metrics. It is configured to remote write all scraped metrics to the victoria-metrics container. vmagent ensures that all relevant portfolio data is reliably collected and stored for visualization and analysis.</p></li>
</ul>
</section>
<section id="data-flow-summary">
<h2>Data Flow Summary<a class="headerlink" href="#data-flow-summary" title="Link to this heading"></a></h2>
<p>The containers interact as follows:</p>
<ol class="arabic simple">
<li><p><strong>eth-portfolio</strong> and/or related exporters expose metrics endpoints.</p></li>
<li><p><strong>vmagent</strong> scrapes these endpoints and forwards the data to <strong>victoria-metrics</strong>.</p></li>
<li><p><strong>victoria-metrics</strong> stores the time-series data for long-term analysis.</p></li>
<li><p><strong>Grafana</strong> is pre-configured to use victoria-metrics as its data source and provides dashboards (such as “Balances”) for visualization.</p></li>
<li><p>The <strong>renderer</strong> container enables Grafana to export dashboards as images for reporting or sharing (if started with <code class="docutils literal notranslate"><span class="pre">--start-renderer</span></code>).</p></li>
</ol>
</section>
<section id="additional-information">
<h2>Additional Information<a class="headerlink" href="#additional-information" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>All containers are orchestrated via Docker Compose and are automatically started as needed.</p></li>
<li><p>Grafana provisioning files ensure dashboards and data sources are set up out-of-the-box.</p></li>
<li><p>Metrics are stored with a long retention period, enabling historical analysis.</p></li>
<li><p>Dashboard images can be generated for reporting via the renderer (if started).</p></li>
</ul>
</section>
<section id="data-extraction-and-portfolio-calculations">
<h2>Data Extraction and Portfolio Calculations<a class="headerlink" href="#data-extraction-and-portfolio-calculations" title="Link to this heading"></a></h2>
<p>The Portfolio Exporter performs a comprehensive extraction and calculation process to ensure accurate and detailed portfolio data. The workflow is as follows:</p>
<p><strong>1. Data Extraction Process</strong></p>
<ul class="simple">
<li><p><strong>Per-Wallet, Per-Timestamp:</strong>
For each wallet specified via the CLI, the exporter iterates over a series of timestamps (based on the <cite>–interval</cite> argument). At each timestamp, it determines the corresponding Ethereum block and extracts a snapshot of the portfolio at that point in time.</p></li>
<li><p><strong>Asynchronous Data Loading:</strong>
The exporter leverages highly concurrent, asynchronous routines to efficiently load data for all wallets and tokens. It uses specialized loader functions to fetch:
- Token balances (including ERC-20 and protocol-specific tokens)
- Transaction history
- Token transfers
- Protocol positions (e.g., lending, borrowing, staking)</p></li>
<li><p><strong>Block and Transaction Resolution:</strong>
For each timestamp, the exporter resolves the closest block and loads all relevant on-chain data for the specified wallets. This includes querying balances, fetching transaction receipts, and aggregating protocol positions.</p></li>
</ul>
<p><strong>2. Portfolio Calculations</strong></p>
<ul class="simple">
<li><p><strong>Balance and Value Computation:</strong>
For each token held by a wallet, the exporter calculates:
- The raw token balance
- The USD value of the balance (using price oracles or on-chain data)
- Protocol-specific metrics (e.g., supplied/borrowed amounts, rewards)</p></li>
<li><p><strong>Aggregation and Structuring:</strong>
The exporter organizes data into logical sections, such as “assets”, “debts”, and “external” protocol positions. It aggregates balances across all wallets and protocols, ensuring a unified view of the portfolio.</p></li>
<li><p><strong>Metric Formatting:</strong>
Each data point is formatted as a Prometheus metric, including metadata such as wallet address, token address, token symbol, protocol name, and a logical “bucket” for grouping. Both the raw balance and USD value are exported for each token.</p></li>
</ul>
<p><strong>3. Export and Storage</strong></p>
<ul class="simple">
<li><p><strong>Deduplication:</strong>
Before exporting, the system checks if data for a given timestamp already exists in the time-series database to avoid redundant processing.</p></li>
<li><p><strong>Export to VictoriaMetrics:</strong>
The processed metrics are sent to the VictoriaMetrics time-series database, where they are stored for long-term analysis and visualization in Grafana.</p></li>
<li><p><strong>Error Handling and Robustness:</strong>
The exporter is designed to handle network errors, missing data, and protocol-specific quirks gracefully, ensuring reliable and repeatable exports.</p></li>
</ul>
<p><strong>Summary</strong></p>
<p>This architecture allows the Portfolio Exporter to provide a high-fidelity, time-resolved view of all wallet balances, protocol positions, and historical portfolio values. The modular, asynchronous design ensures scalability and performance, even for large portfolios or long time ranges.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="caching.html" class="btn btn-neutral float-left" title="Caching in eth-portfolio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="new-protocols.html" class="btn btn-neutral float-right" title="Contributing: Adding New Protocols" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>